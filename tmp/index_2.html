<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/106/three.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r106/examples/js/controls/TrackballControls.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cannon.js/0.6.2/cannon.js"></script>
  
</head>
<body>

  <div id="stage"></div>

  <script>
    
    const world = new CANNON.World();  // cannon.jsでワールド作成
    world.gravity.set(0, -9.82, 0);    // 重力を設定
    
    // ぶつかっている可能性のあるオブジェクト同士を見つける
    world.broadphase = new CANNON.NaiveBroadphase();
    world.solver.iterations = 8;	// 反復計算回数
    world.solver.tolerance = 0.1;       // 許容値


    // cannon.jsで箱作成
    const boxMass = 1;                                               // 箱の質量
    const boxShape = new CANNON.Box(new CANNON.Vec3(5, 5, 5));       // 箱の形状
    const phyBox = new CANNON.Body({mass: boxMass, shape: boxShape});// 箱作成
    phyBox.position.set(0, 20, 0);                                   // 箱の位置
    phyBox.angularVelocity.set(0.1, 0.1, 0.1);                       // 角速度
    phyBox.angularDamping = 0.1;                                     // 減衰率
    
    // ワールドに箱追加
    world.addBody(phyBox);

    // cannon.jsで床作成
    const planeMass = 0;     // 質量を0にすると衝突しても動かない
    const planeShape = new CANNON.Plane();
    const phyPlane = new CANNON.Body({mass: planeMass, shape: planeShape});

    // X軸に90度回転
    phyPlane.quaternion.setFromAxisAngle(new CANNON.Vec3(1, 0, 0), -Math.PI / 2);
    phyPlane.position.set(0, 0, 0);
    world.addBody(phyPlane);
    
  </script>
  
</body>
</html>
